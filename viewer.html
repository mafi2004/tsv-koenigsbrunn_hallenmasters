<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSV Königsbrunn – Hallenmasters | Zuschauer</title>
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
  <style>
    :root{ --page-header-height:64px; --table-sticky-gap:8px; --table-sticky-top:calc(var(--page-header-height) + var(--table-sticky-gap)); }
    *{box-sizing:border-box}
    html{scroll-padding-top: calc(var(--page-header-height) + 12px);} 
    body{font-family:system-ui;margin:0;background:#f9fafb;color:#0f172a}
    header{position:sticky;top:0;z-index:20;background:#0f172a;color:#fff;padding:12px 16px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    header h1{margin:0;font-size:1.2rem}
    .badge{font-size:.85rem;background:#1f2937;color:#cbd5e1;padding:4px 8px;border-radius:999px}
    main{max-width:1000px;margin:16px auto;padding:0 16px}
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    select,input{padding:8px;border:1px solid #cbd5e1;border-radius:8px;background:#fff}
    .tableWrap{background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{position:sticky;top:var(--table-sticky-top);z-index:10;background:#0f172a;color:#fff;padding:10px;font-weight:700}
    th,td{padding:10px 12px;border-bottom:1px solid #e5e7eb;text-align:left}
    tbody tr:hover{background:#f1f5f9}
    .groupTag{display:inline-block;padding:2px 10px;border-radius:999px;font-weight:700;font-size:.85rem;border:1px solid #cbd5e1}
    footer{color:#334155;font-size:.8rem;text-align:center;margin:24px 0}
  </style>
</head>
<body>
  <header>
    <h1 id="title">Spielplan</h1>
    <span class="badge" id="generated">–</span>
  </header>
  <main>
    <div class="filters">
      <label>Gruppe:</label>
      <select id="filterGroup"><option value="">Alle</option><option value="A">A</option><option value="B">B</option><option value="C">C</option></select>
      <label>Feld:</label>
      <select id="filterField"><option value="">Alle</option><option>Feld 1</option><option>Feld 2</option><option>Feld 3</option></select>
      <input type="text" id="filterTeam" placeholder="Team suchen" />
    </div>
    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th>Start</th>
            <th>Ende</th>
            <th>Gruppe</th>
            <th>Runde</th>
            <th>Feld</th>
            <th>Team 1</th>
            <th>Team 2</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </main>
  <footer>TSV Königsbrunn – Hallenmasters · Zuschauer · © 2025</footer>

<script>
  // Sticky header
  function updateStickyTopFromHeader(){ const h=document.querySelector('header'); if(!h) return; document.documentElement.style.setProperty('--page-header-height', Math.ceil(h.getBoundingClientRect().height)+'px'); }
  window.addEventListener('load', updateStickyTopFromHeader); window.addEventListener('resize', updateStickyTopFromHeader);
  if('ResizeObserver' in window){ new ResizeObserver(updateStickyTopFromHeader).observe(document.querySelector('header')); }

  const $=sel=>document.querySelector(sel);
  // LZString minimal (URI safe) decompress
  var LZString=(function(){var f=String.fromCharCode;var keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";var baseReverseDic={};function getBaseValue(alphabet, character){if(!baseReverseDic[alphabet]){baseReverseDic[alphabet]={};for(var i=0;i<alphabet.length;i++){baseReverseDic[alphabet][alphabet.charAt(i)]=i;}}return baseReverseDic[alphabet][character];}function decompressFromEncodedURIComponent(input){if(input==null)return"";if(input=="")return null;input=input.replace(/\s/g, "+");return _decompress(input.length,32,function(index){return getBaseValue(keyStrUriSafe,input.charAt(index));});}function _decompress(length, resetValue, getNextValue){var dictionary=[],next,accBits,enlargeIn,lengthVal=4,entry,result=[],i,bits,maxpower,power,c, data={value:getNextValue(0),position:resetValue,index:1};for(i=0;i<3;i+=1){dictionary[i]=i;}enlargeIn=4;accBits=3;function readBits(numBits){maxpower=Math.pow(2,numBits);power=1;bits=0;while(power!=maxpower){c=data.value & data.position;data.position >>= 1;if(data.position==0){data.position=resetValue;data.value=getNextValue(data.index++);}bits |= (c>0?1:0)*power;power <<= 1;}return bits;}var bitsVal=readBits(2);switch(bitsVal){case 0: c=readBits(8); next=f(c);break;case 1: c=readBits(16); next=f(c);break;case 2: return"";}dictionary[3]=next;result.push(next);while(true){if(data.index>length){return"";}var cc=readBits(accBits);var entry;switch(cc){case 0: c=readBits(8);dictionary[lengthVal++]=f(c);cc=lengthVal-1;enlargeIn--;break;case 1: c=readBits(16);dictionary[lengthVal++]=f(c);cc=lengthVal-1;enlargeIn--;break;case 2: return result.join('');default:}if(enlargeIn==0){enlargeIn=Math.pow(2,accBits);accBits++;}if(dictionary[cc]){entry=dictionary[cc];}else if(cc===lengthVal){entry=next+next.charAt(0);} else {return null;}result.push(entry);dictionary[lengthVal++]=next+entry.charAt(0);enlargeIn--;next=entry;if(enlargeIn==0){enlargeIn=Math.pow(2,accBits);accBits++;}}}return {decompressFromEncodedURIComponent:decompressFromEncodedURIComponent};})();

  function getHashParam(){ const h=window.location.hash||''; const m=h.match(/#s=([^\s]+)/); return m?decodeURIComponent(m[1]):null; }
  function render(data){ $('#title').textContent=data.title||'Spielplan'; const gen=new Date(data.generatedAt||Date.now()); $('#generated').textContent='Stand: '+gen.toLocaleString(); const tb=$('#tbody'); tb.innerHTML=''; const fg=$('#filterGroup').value.toUpperCase(); const ff=$('#filterField').value; const ft=($('#filterTeam').value||'').toLowerCase(); const rows=(data.matches||[]).filter(m=>{ if(fg && m.group!==fg) return false; if(ff && m.field!==ff) return false; if(ft){ const hay=(m.team1+' '+m.team2).toLowerCase(); if(!hay.includes(ft)) return false; } return true; }).sort((a,b)=>{ if(a.start<b.start) return -1; if(a.start>b.start) return 1; return a.field.localeCompare(b.field); }); for(const m of rows){ const tr=document.createElement('tr'); tr.innerHTML=`<td>${m.start}</td><td>${m.end}</td><td><span class="groupTag">${m.group}</span></td><td>${m.round}</td><td>${m.field}</td><td>${m.team1}</td><td>${m.team2}</td>`; tb.appendChild(tr); } }

  async function load(){ const hp=getHashParam(); let json=null; if(hp){ try{ json=LZString.decompressFromEncodedURIComponent(hp); }catch(e){ console.warn('Decompress failed',e); } } if(!json){ try{ const res=await fetch('schedule.json'); if(res.ok){ json=await res.text(); } }catch(e){} } if(!json){ $('#generated').textContent='(keine Daten)'; return; } const data=JSON.parse(json); render(data); }

  ['change','input'].forEach(ev=>{ $('#filterGroup').addEventListener(ev, load); $('#filterField').addEventListener(ev, load); $('#filterTeam').addEventListener(ev, load); });
  load(); setInterval(load,30000);
</script>
</body>
</html>