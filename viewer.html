<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSV Königsbrunn – Hallenmasters | Zuschauer</title>
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
  <style>
    body{font-family:system-ui;margin:0;background:#f9fafb;color:#0f172a}
    header{position:sticky;top:0;z-index:20;background:#0f172a;color:#fff;padding:12px 16px}
    main{max-width:1000px;margin:16px auto;padding:0 16px}
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    select,input{padding:8px;border:1px solid #cbd5e1;border-radius:8px;background:#fff}
    .tableWrap{background:#fff;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{position:sticky;top:64px;background:#0f172a;color:#fff;padding:10px;font-weight:700}
  </style>
</head>
<body>
<header><h1 id="title">Spielplan</h1><span id="generated" style="font-size:.9rem;opacity:.85"></span></header>
<main>
  <div class="filters"><label>Gruppe</label><select id="fg"><option value="">Alle</option><option>A</option><option>B</option><option>C</option></select><label>Feld</label><select id="ff"><option value="">Alle</option><option>Feld 1</option><option>Feld 2</option><option>Feld 3</option></select><input id="ft" placeholder="Team suchen"></div>
  <div class="tableWrap"><table><thead><tr><th>Start</th><th>Ende</th><th>Gruppe</th><th>Runde</th><th>Feld</th><th>Team 1</th><th>Team 2</th></tr></thead><tbody id="tb"></tbody></table></div>
</main>
<script>
function getHashParam(){const h=window.location.hash||'';const m=h.match(/#s=([^\s]+)/);return m?decodeURIComponent(m[1]):null}
function render(data){document.getElementById('title').textContent=data.title||'Spielplan';document.getElementById('generated').textContent='Stand: '+new Date(data.generatedAt||Date.now()).toLocaleString();const tb=document.getElementById('tb');tb.innerHTML='';const fg=document.getElementById('fg').value.toUpperCase();const ff=document.getElementById('ff').value;const ft=(document.getElementById('ft').value||'').toLowerCase();const rows=(data.matches||[]).filter(m=>{if(fg&&m.group!==fg)return false;if(ff&&m.field!==ff)return false;const hay=(m.team1+' '+m.team2).toLowerCase();return !ft||hay.includes(ft)}).sort((a,b)=>a.start<b.start?-1:a.start>b.start?1:a.field.localeCompare(b.field));for(const m of rows){const tr=document.createElement('tr');tr.innerHTML=`<td>${m.start}</td><td>${m.end}</td><td>${m.group}</td><td>${m.round}</td><td>${m.field}</td><td>${m.team1}</td><td>${m.team2}</td>`;tb.appendChild(tr)}}
async function load(){const hp=getHashParam();let json=null;if(hp){json=decodeURIComponent(hp)}if(!json){try{const res=await fetch('schedule.json');if(res.ok){json=await res.text()}}catch(e){}}
if(!json){document.getElementById('generated').textContent='(keine Daten)';return}const data=JSON.parse(json);render(data)}
['change','input'].forEach(ev=>{document.getElementById('fg').addEventListener(ev,load);document.getElementById('ff').addEventListener(ev,load);document.getElementById('ft').addEventListener(ev,load);});
load();setInterval(load,30000);
</script>
</body>
</html>