<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSV Königsbrunn – Hallenmasters | Zuschauer</title>
  <meta name="description" content="Zuschauer-Ansicht: Read-Only Spielplan mit Zeiten, Gruppe, Feld und Teams." />
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
  <style>
    :root{ --page-header-height: 64px; --table-sticky-gap: 8px; --table-sticky-top: calc(var(--page-header-height) + var(--table-sticky-gap)); }
    *{box-sizing:border-box}
    html{scroll-padding-top: calc(var(--page-header-height) + 12px);} 
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif; background:#f9fafb; color:#0f172a}
    header{position:sticky; top:0; z-index:20; background:#0f172a; color:#fff; padding:12px 16px; display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    header h1{margin:0; font-size:1.2rem}
    .badge{font-size:.8rem; background:#1f2937; color:#cbd5e1; padding:4px 8px; border-radius:999px}
    .container{max-width:1000px; margin:16px auto; padding:0 16px}
    .filters{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px}
    select, input[type="text"]{padding:8px 10px; border-radius:8px; border:1px solid #cbd5e1; background:#fff}
    .tableWrap{background:#fff; border:1px solid #e5e7eb; border-radius:12px; overflow:hidden}
    table{width:100%; border-collapse:separate; border-spacing:0}
    thead th{position:sticky; top: var(--table-sticky-top); z-index: 10; background:#0f172a; color:#fff; padding:10px 12px; font-weight:700}
    th, td{padding:10px 12px; border-bottom:1px solid #e5e7eb; text-align:left}
    tbody tr:hover{background:#f1f5f9}
    .groupTag{display:inline-block; padding:2px 10px; border-radius:999px; font-weight:700; font-size:.85rem}
    .A{background:#10b98122; color:#0f172a; border:1px solid #10b98155}
    .B{background:#f9731622; color:#0f172a; border:1px solid #f9731655}
    .C{background:#6366f122; color:#0f172a; border:1px solid #6366f155}
    footer{color:#334155; font-size:.8rem; text-align:center; margin:24px 0}
  </style>
</head>
<body>
  <header>
    <h1 id="title">Spielplan</h1>
    <span class="badge" id="generated">–</span>
  </header>
  <div class="container">
    <div class="filters">
      <label>Gruppe:</label>
      <select id="filterGroup">
        <option value="">Alle</option>
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
      </select>
      <label>Feld:</label>
      <select id="filterField">
        <option value="">Alle</option>
        <option>Feld 1</option>
        <option>Feld 2</option>
        <option>Feld 3</option>
      </select>
      <input type="text" id="filterTeam" placeholder="Team suchen" />
    </div>
    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th>Start</th>
            <th>Ende</th>
            <th>Gruppe</th>
            <th>Runde</th>
            <th>Feld</th>
            <th>Team 1</th>
            <th>Team 2</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
  <footer>TSV Königsbrunn – Hallenmasters · Zuschauer · © 2025</footer>

<script>
  function updateStickyTopFromHeader(){ const h=document.querySelector('header'); if(!h) return; document.documentElement.style.setProperty('--page-header-height', Math.ceil(h.getBoundingClientRect().height)+'px'); }
  window.addEventListener('load', updateStickyTopFromHeader);
  window.addEventListener('resize', updateStickyTopFromHeader);
  if('ResizeObserver' in window){ new ResizeObserver(updateStickyTopFromHeader).observe(document.querySelector('header')); }

  const $=sel=>document.querySelector(sel);
  function decodeBase64Utf8(b64){ const bin=atob(b64); const bytes=new Uint8Array([...bin].map(c=>c.charCodeAt(0))); return new TextDecoder().decode(bytes); }

  async function loadData(){
    const url=new URL(window.location.href); const s=url.searchParams.get('s'); let data=null;
    if(s){ try{ data=JSON.parse(decodeBase64Utf8(s)); }catch(e){ console.warn('Konnte Daten nicht dekodieren:', e); } }
    if(!data){ // Fallback: try schedule.json
      try{ const res=await fetch('schedule.json'); if(res.ok){ data=await res.json(); } }
      catch(e){ console.warn('Kein schedule.json gefunden.'); }
    }
    if(!data){ $('#title').textContent='Spielplan'; $('#generated').textContent='(keine Daten)'; return; }
    render(data);
  }

  function render(data){
    $('#title').textContent=data.title||'Spielplan';
    const gen=new Date(data.generatedAt||Date.now()); $('#generated').textContent='Stand: '+gen.toLocaleString();
    const tb=$('#tbody'); tb.innerHTML='';
    const fg=$('#filterGroup').value.toUpperCase(); const ff=$('#filterField').value; const ft=($('#filterTeam').value||'').toLowerCase();
    const rows=(data.matches||[]).filter(m=>{
      if(fg && m.group!==fg) return false;
      if(ff && m.field!==ff) return false;
      if(ft){ const hay=(m.team1+' '+m.team2).toLowerCase(); if(!hay.includes(ft)) return false; }
      return true;
    }).sort((a,b)=>{
      if(a.start<b.start) return -1; if(a.start>b.start) return 1; return a.field.localeCompare(b.field);
    });
    for(const m of rows){ const tr=document.createElement('tr'); tr.innerHTML=`<td>${m.start}</td><td>${m.end}</td><td><span class="groupTag ${m.group}">${m.group}</span></td><td>${m.round}</td><td>${m.field}</td><td>${m.team1}</td><td>${m.team2}</td>`; tb.appendChild(tr); }
  }

  ['change','input'].forEach(ev=>{ $('#filterGroup').addEventListener(ev, loadData); $('#filterField').addEventListener(ev, loadData); $('#filterTeam').addEventListener(ev, loadData); });
  loadData(); setInterval(loadData, 30000);
</script>
</body>
</html>