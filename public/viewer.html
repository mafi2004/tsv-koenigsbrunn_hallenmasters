<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Viewer ‚Äì Funino Champions League</title>
  <style>
    :root{ --bg:#0f172a; --fg:#e5e7eb; --border:#1f2937; --grpA-bg:#0b1b3a; --grpA-fg:#bfdbfe; --grpA-br:#1d4ed8; --grpB-bg:#2b0c0c; --grpB-fg:#fecaca; --grpB-br:#7f1d1d; --grpC-bg:#052e1b; --grpC-fg:#86efac; --grpC-br:#166534; }
    body{ margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial }
    header{ padding:1rem; border-bottom:1px solid var(--border) }
    main{ padding:1rem; max-width:1100px; margin:0 auto }
    table{ width:100%; border-collapse:collapse }
    th,td{ border-bottom:1px solid var(--border); padding:.5rem; text-align:left }
    th{ color:#cbd5e1 }
    tr.grpA td{ background:rgba(29,78,216,.08) } tr.grpB td{ background:rgba(220,38,38,.08) } tr.grpC td{ background:rgba(22,163,74,.08) }
    .pill{ display:inline-block; border:1px solid var(--border); border-radius:999px; padding:.15rem .5rem; font-size:.85rem }
    .pill.grpA{ color:var(--grpA-fg); border-color:var(--grpA-br); background:var(--grpA-bg) }
    .pill.grpB{ color:var(--grpB-fg); border-color:var(--grpB-br); background:var(--grpB-bg) }
    .pill.grpC{ color:var(--grpC-fg); border-color:var(--grpC-br); background:var(--grpC-bg) }
	
/* Sieger-Markierung direkt beim Teamnamen */
.winIcon {
  display: inline-block;
  margin-left: 0.4rem;
  font-size: 1rem;          /* Icon-Gr√∂√üe */
  vertical-align: middle;
  /* sanfter Glow f√ºr bessere Lesbarkeit auf dunklem Hintergrund */
  filter: drop-shadow(0 0 2px rgba(0,0,0,0.6));
}

/* Gewinner-Team: optional etwas hervorheben */
.teamCell.winner {
  font-weight: 700;
   color: #fde68a;           /* warmes Gelb; passt zu dunklem Theme */

  </style>
  <script>
    var ORIGIN=window.location.origin; var API_BASE=ORIGIN + '/api';
    function groupClass(g){ var x=String(g||'').toUpperCase(); return x==='A'?'grpA':x==='B'?'grpB':x==='C'?'grpC':''; }
    async function loadMatches(){ var res = await fetch(API_BASE + '/matches'); if(!res.ok) throw new Error('HTTP '+res.status); return res.json(); }
    
function render(matches){
  const tbody = document.querySelector('#matches tbody');
  tbody.innerHTML = '';

  matches.forEach(m => {
    const tr = document.createElement('tr');
    tr.className = groupClass(m.groupName);

    const td = (txt) => { const d=document.createElement('td'); d.textContent = txt ?? ''; return d; };

    // Gruppe-Badge
    const badgeCell = document.createElement('td');
    const badge = document.createElement('span');
    badge.className = 'pill ' + groupClass(m.groupName);
    badge.textContent = m.groupName ?? '';
    badgeCell.appendChild(badge);

    // Team-Zellen
    const teamAId   = m?.teamA_id ?? null;
    const teamBId   = m?.teamB_id ?? null;
    const teamAName = m?.teamA ?? (teamAId != null ? String(teamAId) : '');
    const teamBName = m?.teamB ?? (teamBId != null ? String(teamBId) : '');
    const winnerVal = m?.winner ?? null;

    const tdA = document.createElement('td'); tdA.className = 'teamCell'; tdA.textContent = teamAName;
    const tdB = document.createElement('td'); tdB.className = 'teamCell'; tdB.textContent = teamBName;

    if (winnerVal != null) {
      const w = Number(winnerVal);
      if (!Number.isNaN(w)) {
        if (teamAId != null && w === Number(teamAId)) {
          tdA.classList.add('winner');
          const icon = document.createElement('span');
          icon.className = 'winIcon'; icon.textContent = 'üèÜ'; icon.title = 'Sieger';
          tdA.appendChild(icon);
        } else if (teamBId != null && w === Number(teamBId)) {
          tdB.classList.add('winner');
          const icon = document.createElement('span');
          icon.className = 'winIcon'; icon.textContent = 'üèÜ'; icon.title = 'Sieger';
          tdB.appendChild(icon);
        }
      }
    }

    tr.appendChild(td(m.id));
    tr.appendChild(badgeCell);
    tr.appendChild(td(m.field));
    tr.appendChild(tdA);
       tr.appendChild(tdB);

    tbody.appendChild(tr);
  });
}

    async function reload(){ try{ var rows=await loadMatches(); render(rows); }catch(e){ console.error('Viewer reload failed:', e); } }
    document.addEventListener('DOMContentLoaded', function(){ reload(); });
  </script>
  <script src="/socket.io/socket.io.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){ var s=window.io?window.io():null; if(!s) return; s.on('connect', function(){ console.log('Viewer socket connected'); }); s.on('resultUpdate', function(){ reload(); }); s.on('results:updated', function(){ reload(); }); s.on('group:started', function(){ reload(); }); s.on('round:advanced', function(){ reload(); }); s.on('matches:reset', function(){ reload(); }); setInterval(function(){ reload(); }, 10000); });
  </script>
</head>
<body>
  <header><h1>Viewer ‚Äì Funino Champions League</h1></header>
  <main>
    <table id="matches"><thead><tr>
<th>ID</th>
<th>Gruppe</th>
<th>Feld</th>
<th>Team A</th>
<th>Team B</th>
</tr></thead><tbody></tbody></table>
  </main>
</body>
</html>
