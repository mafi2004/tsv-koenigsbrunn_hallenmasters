<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSV Königsbrunn – Hallenmasters | Admin</title>
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
  <style>
    body{font-family:system-ui;margin:0;background:#f9fafb;color:#0f172a;padding:16px}
    h1{margin-top:0}
    section{margin-bottom:24px;padding:16px;background:#fff;border:1px solid #e5e7eb;border-radius:12px}
    label{display:block;margin:8px 0 4px}
    input,select,button{padding:8px;border:1px solid #cbd5e1;border-radius:8px;background:#fff}
    button{cursor:pointer;background:#0f172a;color:#fff;font-weight:600}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #e5e7eb;padding:8px;text-align:left}
    th{background:#0f172a;color:#fff}
  </style>
</head>
<body>
  <h1>Adminbereich – Hallenmasters</h1>

  <!-- Teams -->
  <section>
    <h2>Teams verwalten</h2>
    <label>Teamname:</label>
    <input type="text" id="teamName" />
    <button onclick="addTeam()">Team hinzufügen</button>
    <table>
      <thead><tr><th>ID</th><th>Name</th></tr></thead>
      <tbody id="teamsBody"></tbody>
    </table>
  </section>

  <!-- Spiele -->
  <section>
    <h2>Spiele anlegen</h2>
    <label>Team A:</label>
    <select id="teamA"></select>
    <label>Team B:</label>
    <select id="teamB"></select>
    <label>Gruppe:</label>
    <input type="text" id="group" placeholder="z.B. A" />
    <label>Runde:</label>
    <input type="text" id="round" placeholder="z.B. Vorrunde" />
    <label>Feld:</label>
    <input type="text" id="field" placeholder="z.B. Feld 1" />
    <button onclick="addMatch()">Spiel hinzufügen</button>
    <table>
      <thead><tr><th>ID</th><th>Team A</th><th>Team B</th><th>Gruppe</th><th>Runde</th><th>Feld</th><th>Ergebnis</th><th>Aktion</th></tr></thead>
      <tbody id="matchesBody"></tbody>
    </table>
  </section>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
  const API = "http://localhost:3001/api";

  // Teams laden
  async function loadTeams(){
    const res = await fetch(API+"/teams");
    const teams = await res.json();
    const body = document.getElementById("teamsBody");
    const selA = document.getElementById("teamA");
    const selB = document.getElementById("teamB");
    body.innerHTML = "";
    selA.innerHTML = "";
    selB.innerHTML = "";
    for(const t of teams){
      body.innerHTML += `<tr><td>${t.id}</td><td>${t.name}</td></tr>`;
      selA.innerHTML += `<option value="${t.id}">${t.name}</option>`;
      selB.innerHTML += `<option value="${t.id}">${t.name}</option>`;
    }
  }

  async function addTeam(){
    const name = document.getElementById("teamName").value;
    if(!name) return;
    await fetch(API+"/teams", {
      method:"POST", headers:{'Content-Type':'application/json'},
      body: JSON.stringify({name})
    });
    document.getElementById("teamName").value="";
    loadTeams();
  }

  // Spiele laden
  async function loadMatches(){
    const res = await fetch(API+"/matches");
    const matches = await res.json();
    const body = document.getElementById("matchesBody");
    body.innerHTML = "";
    for(const m of matches){
      body.innerHTML += `
        <tr>
          <td>${m.id}</td>
          <td>${m.teamA}</td>
          <td>${m.teamB}</td>
          <td>${m.group||''}</td>
          <td>${m.round||''}</td>
          <td>${m.field||''}</td>
          <td>${m.scoreA!=null? m.scoreA+" : "+m.scoreB : "-"}</td>
          <td>
            <input type="number" id="sA${m.id}" value="${m.scoreA||0}" style="width:50px" />
            <input type="number" id="sB${m.id}" value="${m.scoreB||0}" style="width:50px" />